(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{419:function(s,a,n){"use strict";n.r(a);var t=n(17),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"lnmp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lnmp"}},[s._v("#")]),s._v(" Lnmp")]),s._v(" "),n("h2",{attrs:{id:"挂在-aws-磁盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#挂在-aws-磁盘"}},[s._v("#")]),s._v(" 挂在 aws 磁盘")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/huang0925/p/3879542.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看磁盘情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/xvda1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".6G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("% /\ndevtmpfs        486M   60K  486M   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("% /dev\ntmpfs           499M     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  499M   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看存储情况")]),s._v("\nlsblk\nNAME    MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nxvda    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("202")]),s._v(":0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n└─xvda1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("202")]),s._v(":1    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   8G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /\nxvdf    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("202")]),s._v(":80   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  20G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用file命令来查看该块硬盘有没有建立文件系统")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -s /dev/xvdf\n/dev/xvdf: data\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用下述命令来给xvdf来创建文件系统")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkfs")]),s._v(" -t ext4 /dev/xvdf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后再用file命令确认")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" -s /dev/xvdf\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接下来要将该文件系统加入到当前实例的文件系统树中，这里要使用mount命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /webData\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/xvdf /webData\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 搞定，现在看看EC2实例的存储情况")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以在/webData目录下随意创建文件和文件夹了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里并不是万事大吉的时候，我们需要将该MOUNTPOINT加入到系统文件中，要不然系统重启后还是找不到该硬盘。编辑/etc/fstab文件，在其中加入以下行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/fstab\n/dev/xvdf       /data   ext4    defaults,nofail        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这样就不怕重启的时候丢失该MOUNTPOINT了。添加完毕以后可以试一下fstab文件是否能正常运行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" -a\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有错误就一切万事大吉，如果有错误而你重启了电脑的话，你就等着哭吧")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h2",{attrs:{id:"安装-lnmp"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-lnmp"}},[s._v("#")]),s._v(" 安装 Lnmp")]),s._v(" "),n("p",[s._v("通过https://lnmp.org/安装报安装")]),s._v(" "),n("h3",{attrs:{id:"修改配置文件-lnmp-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件-lnmp-conf"}},[s._v("#")]),s._v(" 修改配置文件 lnmp.conf")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Download_Mirror")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://soft.vpser.net'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Nginx_Modules_Options")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PHP_Modules_Options")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##MySQL/MariaDB database directory##")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MySQL_Data_Dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/webData/usr/local/mysql/var'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MariaDB_Data_Dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/webData/usr/local/mariadb/var'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##Default website home directory##")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Default_Website_Dir")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/webData/wwwroot/default'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Enable_Nginx_Openssl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'y'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Enable_PHP_Fileinfo")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'n'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Enable_Nginx_Lua")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'n'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Enable_Swap")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'y'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"运行安装文件，选择配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行安装文件，选择配置"}},[s._v("#")]),s._v(" 运行安装文件，选择配置")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("./install.sh lnmp\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("Mysql 5.7.26\n"),n("ul",[n("li",[s._v("enable the InnoDB Storage Engine")])])]),s._v(" "),n("li",[s._v("PHP 7.2.24")]),s._v(" "),n("li",[s._v("Install Jemalloc")])]),s._v(" "),n("h3",{attrs:{id:"生成配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成配置文件"}},[s._v("#")]),s._v(" 生成配置文件")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("; 修改\ndisable_functions = passthru,system,chroot,chgrp,chown,shell_exec,proc_open,proc_get_status,popen,ini_alter,ini_restore,dl,readlink,symlink,popepassthru,stream_socket_server\n\n; 修改\nexpose_php = Off\n\n; 开启\nmax_input_vars = 5000\n\n; 修改\nmemory_limit = 4048M\n\n; 修改\npost_max_size = 128M\n\n; [opcache]\nopcache.enable=1\nopcache.enable_cli=0\nopcache.memory_consumption=512\nopcache.interned_strings_buffer=8\nopcache.max_accelerated_files=60000\nopcache.validate_timestamps=1\nopcache.revalidate_freq=6\nopcache.consistency_checks=0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h2",{attrs:{id:"magento-配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#magento-配置"}},[s._v("#")]),s._v(" magento 配置")]),s._v(" "),n("p",[s._v("在项目目录下创建 magento2-cors.conf 文件，写入以下内容")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# Note: for 'Access-Control-Allow-Origin' we use '*' instead of 'https://www.your-website.co.uk'\n# to be absolutely sure that these assets can be served to any origin, since we have a mixture of CDN,\n# frontend url and admin url. We want to mitigate the risk of these PUBLIC assets not being served.\n\nadd_header 'Access-Control-Allow-Origin' '*' 'always';\n\nif ($request_method = 'OPTIONS') {\n    add_header 'Access-Control-Allow-Origin' '*' 'always';\n    add_header 'Access-Control-Allow-Headers' 'x-requested-with' 'always';\n    add_header 'Access-Control-Max-Age' 86400 'always';\n    add_header 'Content-Length' 0 'always';\n    return 204;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("在安装页面是，请求出错。修改 nginx.conf.sample")]),s._v(" "),n("div",{staticClass:"language-conf line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('location ~* ^/setup($|/) {\n    root $MAGE_ROOT;\n    location ~ ^/setup/index.php {\n        ; 加入下面这句话\n        fastcgi_split_path_info ^(.+?\\.php)(/.*)$;\n\n        fastcgi_pass   fastcgi_backend;\n\n        fastcgi_param  PHP_FLAG  "session.auto_start=off \\n suhosin.session.cryptua=off";\n        fastcgi_param  PHP_VALUE "memory_limit=756M \\n max_execution_time=600";\n        fastcgi_read_timeout 600s;\n        fastcgi_connect_timeout 600s;\n\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n\n    location ~ ^/setup/(?!pub/). {\n        deny all;\n    }\n\n    location ~ ^/setup/pub/ {\n        add_header X-Frame-Options "SAMEORIGIN";\n    }\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);