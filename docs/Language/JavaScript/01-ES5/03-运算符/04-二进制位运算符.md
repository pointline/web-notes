# 二进制位运算符

## 概述

二进制位运算符用于直接对二进制位进行计算，一共有7个

+ 二进制或运算符（or）：符号为|，表示若两个二进制位都为0，则结果为0，否则为1
+ 二进制与运算符（and）：符号为&，表示若两个二进制位都为1，则结果为1，否则为0
+ 二进制否运算符（not）：符号为~，表示对一个二进制位取反
+ 异或运算符（xor）：符号为^，表示若两个二进制位不相同，则结果为1，否则为0
+ 左移运算符（left shift）：符号为<<，详见下文解释
+ 右移运算符（right shift）：符号为>>，详见下文解释
+ 头部补零的右移运算符（zero filled right shift）：符号为>>>，详见下文解释

`这些位运算符直接处理每一个比特位（bit），所以是非常底层的运算，好处是速度极快，缺点是很不直观，许多场合不能使用它们，否则会使代码难以理解和查错`

`有一点需要特别注意，位运算符只对整数起作用，如果一个运算子不是整数，会自动转为整数后再执行。另外，虽然在 JavaScript 内部，数值都是以64位浮点数的形式储存，但是做位运算的时候，是以32位带符号的整数进行运算的，并且返回值也是一个32位带符号的整数`

```javascript
i = i | 0;
```

`上面这行代码的意思，就是将i（不管是整数或小数）转为32位整数`

利用这个特性，可以写出一个函数，将任意数值转为32位整数

```javascript
function toInt32(x) {
  return x | 0;
}
```

上面这个函数将任意值与0进行一次或运算，这个位运算会自动将一个值转为32位整数。下面是这个函数的用法

```javascript
toInt32(1.001) // 1
toInt32(1.999) // 1
toInt32(1) // 1
toInt32(-1) // -1
toInt32(Math.pow(2, 32) + 1) // 1
toInt32(Math.pow(2, 32) - 1) // -1
```

`上面代码中，toInt32可以将小数转为整数。对于一般的整数，返回值不会有任何变化。对于大于或等于2的32次方的整数，大于32位的数位都会被舍去`

## 二进制或运算符

`二进制或运算符（|）逐位比较两个运算子，两个二进制位之中只要有一个为1，就返回1，否则返回0`

```javascript
0 | 3 // 3
```

上面代码中，0和3的二进制形式分别是00和11，所以进行二进制或运算会得到11（即3）

`位运算只对整数有效，遇到小数时，会将小数部分舍去，只保留整数部分。所以，将一个小数与0进行二进制或运算，等同于对该数去除小数部分，即取整数位`

```javascript
2.9 | 0 // 2
-2.9 | 0 // -2
```

## 二进制与运算符

`二进制与运算符（&）的规则是逐位比较两个运算子，两个二进制位之中只要有一个位为0，就返回0，否则返回1`

```javascript
0 & 3 // 0
```

## 二进制否运算符

`二进制否运算符（~）将每个二进制位都变为相反值（0变为1，1变为0）。它的返回结果有时比较难理解，因为涉及到计算机内部的数值表示机制`

对一个整数连续两次二进制否运算，得到它自身

```javascript
~~3 // 3
```

`所有的位运算都只对整数有效。二进制否运算遇到小数时，也会将小数部分舍去，只保留整数部分。所以，对一个小数连续进行两次二进制否运算，能达到取整效果`

```javascript
~~2.9 // 2
~~47.11 // 47
~~1.9999 // 1
~~3 // 3
```

`使用二进制否运算取整，是所有取整方法中最快的一种`

## 异或运算符

`异或运算（^）在两个二进制位不同时返回1，相同时返回0`

```javascript
0 ^ 3 // 3
```

上面表达式中，0（二进制00）与3（二进制11）进行异或运算，它们每一个二进制位都不同，所以得到11（即3）

`“异或运算”有一个特殊运用，连续对两个数a和b进行三次异或运算，a^=b; b^=a; a^=b;，可以互换它们的值。这意味着，使用“异或运算”可以在不引入临时变量的前提下，互换两个变量的值`

```javascript
var a = 10;
var b = 99;

a ^= b, b ^= a, a ^= b;

a // 99
b // 10
```

`这是互换两个变量的值的最快方法`

`异或运算也可以用来取整`

```javascript
12.9 ^ 0 // 12
```

## 总结
+ 位运算符只对整数起作用，如果一个运算子不是整数，会自动转为整数后再执行
+ 做位运算的时候，是以32位带符号的整数进行运算的，并且返回值也是一个32位带符号的整数
+ 二进制或运算符：两个二进制位都为0，则为0，否则为1
+ 二进制与运算符：两个二进制位都为1，则为1，否则为0
+ 二进制否运算符：对一个二进制位取反
+ 二进制异或运算符：两个二进制位不相同，则为1，否则为0
