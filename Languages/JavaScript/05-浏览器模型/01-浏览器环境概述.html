<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器环境概述 | Notes</title>
    <meta name="description" content="前端笔记">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="assets/favicon.ico">
    
    <link rel="preload" href="/web-notes/assets/css/0.styles.8c3e9f07.css" as="style"><link rel="preload" href="/web-notes/assets/js/app.4d3d7f31.js" as="script"><link rel="preload" href="/web-notes/assets/js/2.ff08d743.js" as="script"><link rel="preload" href="/web-notes/assets/js/100.498b8ac0.js" as="script"><link rel="prefetch" href="/web-notes/assets/js/10.76cff436.js"><link rel="prefetch" href="/web-notes/assets/js/101.2debcbfa.js"><link rel="prefetch" href="/web-notes/assets/js/102.bb74f2af.js"><link rel="prefetch" href="/web-notes/assets/js/103.a5c87f48.js"><link rel="prefetch" href="/web-notes/assets/js/104.d3a66cde.js"><link rel="prefetch" href="/web-notes/assets/js/105.15dbafc6.js"><link rel="prefetch" href="/web-notes/assets/js/106.3568137d.js"><link rel="prefetch" href="/web-notes/assets/js/107.1057e9e6.js"><link rel="prefetch" href="/web-notes/assets/js/108.4de59409.js"><link rel="prefetch" href="/web-notes/assets/js/109.1293cf5b.js"><link rel="prefetch" href="/web-notes/assets/js/11.22966190.js"><link rel="prefetch" href="/web-notes/assets/js/110.4ecf9c94.js"><link rel="prefetch" href="/web-notes/assets/js/111.b16b5ab3.js"><link rel="prefetch" href="/web-notes/assets/js/112.64ed5a8c.js"><link rel="prefetch" href="/web-notes/assets/js/113.435fea94.js"><link rel="prefetch" href="/web-notes/assets/js/114.681e02e7.js"><link rel="prefetch" href="/web-notes/assets/js/115.5f789496.js"><link rel="prefetch" href="/web-notes/assets/js/116.a139f430.js"><link rel="prefetch" href="/web-notes/assets/js/117.44140c1d.js"><link rel="prefetch" href="/web-notes/assets/js/118.6081dd5f.js"><link rel="prefetch" href="/web-notes/assets/js/119.9b74e3af.js"><link rel="prefetch" href="/web-notes/assets/js/12.89893eb4.js"><link rel="prefetch" href="/web-notes/assets/js/120.039d8a4e.js"><link rel="prefetch" href="/web-notes/assets/js/121.ac821ed0.js"><link rel="prefetch" href="/web-notes/assets/js/122.6cfef29a.js"><link rel="prefetch" href="/web-notes/assets/js/123.c4ae4710.js"><link rel="prefetch" href="/web-notes/assets/js/124.9b73605c.js"><link rel="prefetch" href="/web-notes/assets/js/125.055261a6.js"><link rel="prefetch" href="/web-notes/assets/js/126.67c510e0.js"><link rel="prefetch" href="/web-notes/assets/js/127.1e61e72b.js"><link rel="prefetch" href="/web-notes/assets/js/128.771a9373.js"><link rel="prefetch" href="/web-notes/assets/js/129.e4c0dcc6.js"><link rel="prefetch" href="/web-notes/assets/js/13.79e3a870.js"><link rel="prefetch" href="/web-notes/assets/js/130.be947445.js"><link rel="prefetch" href="/web-notes/assets/js/131.d9bff0c2.js"><link rel="prefetch" href="/web-notes/assets/js/132.f87bf6e6.js"><link rel="prefetch" href="/web-notes/assets/js/133.8e1f8dec.js"><link rel="prefetch" href="/web-notes/assets/js/134.f5a259d7.js"><link rel="prefetch" href="/web-notes/assets/js/135.40974398.js"><link rel="prefetch" href="/web-notes/assets/js/136.c57f4b3d.js"><link rel="prefetch" href="/web-notes/assets/js/137.99642fad.js"><link rel="prefetch" href="/web-notes/assets/js/138.f1f4e321.js"><link rel="prefetch" href="/web-notes/assets/js/139.9e147780.js"><link rel="prefetch" href="/web-notes/assets/js/14.643cf707.js"><link rel="prefetch" href="/web-notes/assets/js/140.6f4dd8fb.js"><link rel="prefetch" href="/web-notes/assets/js/141.5ddddd69.js"><link rel="prefetch" href="/web-notes/assets/js/142.91e4e080.js"><link rel="prefetch" href="/web-notes/assets/js/143.8f5ddbfb.js"><link rel="prefetch" href="/web-notes/assets/js/15.ebeb3ce3.js"><link rel="prefetch" href="/web-notes/assets/js/16.08b0399a.js"><link rel="prefetch" href="/web-notes/assets/js/17.5587b41d.js"><link rel="prefetch" href="/web-notes/assets/js/18.8c61a0f3.js"><link rel="prefetch" href="/web-notes/assets/js/19.3aa8268e.js"><link rel="prefetch" href="/web-notes/assets/js/20.1017b021.js"><link rel="prefetch" href="/web-notes/assets/js/21.cecffc4c.js"><link rel="prefetch" href="/web-notes/assets/js/22.cd00c8ec.js"><link rel="prefetch" href="/web-notes/assets/js/23.2805479e.js"><link rel="prefetch" href="/web-notes/assets/js/24.ab523fbb.js"><link rel="prefetch" href="/web-notes/assets/js/25.d146180f.js"><link rel="prefetch" href="/web-notes/assets/js/26.75f3fe47.js"><link rel="prefetch" href="/web-notes/assets/js/27.b0e59beb.js"><link rel="prefetch" href="/web-notes/assets/js/28.d1b20237.js"><link rel="prefetch" href="/web-notes/assets/js/29.393a5858.js"><link rel="prefetch" href="/web-notes/assets/js/3.0f55bd79.js"><link rel="prefetch" href="/web-notes/assets/js/30.1b179666.js"><link rel="prefetch" href="/web-notes/assets/js/31.ea183cca.js"><link rel="prefetch" href="/web-notes/assets/js/32.9ceb0d51.js"><link rel="prefetch" href="/web-notes/assets/js/33.ffc57f92.js"><link rel="prefetch" href="/web-notes/assets/js/34.98f0f97c.js"><link rel="prefetch" href="/web-notes/assets/js/35.31f89b69.js"><link rel="prefetch" href="/web-notes/assets/js/36.1f6c988d.js"><link rel="prefetch" href="/web-notes/assets/js/37.34f25b40.js"><link rel="prefetch" href="/web-notes/assets/js/38.27dd4e40.js"><link rel="prefetch" href="/web-notes/assets/js/39.39589653.js"><link rel="prefetch" href="/web-notes/assets/js/4.89a73d43.js"><link rel="prefetch" href="/web-notes/assets/js/40.32852eaf.js"><link rel="prefetch" href="/web-notes/assets/js/41.f52d6f80.js"><link rel="prefetch" href="/web-notes/assets/js/42.20704e98.js"><link rel="prefetch" href="/web-notes/assets/js/43.2f14657f.js"><link rel="prefetch" href="/web-notes/assets/js/44.1c471dd5.js"><link rel="prefetch" href="/web-notes/assets/js/45.96a92923.js"><link rel="prefetch" href="/web-notes/assets/js/46.536e397e.js"><link rel="prefetch" href="/web-notes/assets/js/47.4263ca0d.js"><link rel="prefetch" href="/web-notes/assets/js/48.0538154b.js"><link rel="prefetch" href="/web-notes/assets/js/49.403d6cf5.js"><link rel="prefetch" href="/web-notes/assets/js/5.9739fa67.js"><link rel="prefetch" href="/web-notes/assets/js/50.f16b4e4e.js"><link rel="prefetch" href="/web-notes/assets/js/51.5b994fe2.js"><link rel="prefetch" href="/web-notes/assets/js/52.051f2def.js"><link rel="prefetch" href="/web-notes/assets/js/53.bbd7dd70.js"><link rel="prefetch" href="/web-notes/assets/js/54.dedca66b.js"><link rel="prefetch" href="/web-notes/assets/js/55.bdd146b4.js"><link rel="prefetch" href="/web-notes/assets/js/56.0acf6fea.js"><link rel="prefetch" href="/web-notes/assets/js/57.a80ae64b.js"><link rel="prefetch" href="/web-notes/assets/js/58.84edb363.js"><link rel="prefetch" href="/web-notes/assets/js/59.07e1420f.js"><link rel="prefetch" href="/web-notes/assets/js/6.fded7e15.js"><link rel="prefetch" href="/web-notes/assets/js/60.5e359b97.js"><link rel="prefetch" href="/web-notes/assets/js/61.7f82f978.js"><link rel="prefetch" href="/web-notes/assets/js/62.df70a05f.js"><link rel="prefetch" href="/web-notes/assets/js/63.ba8c30d9.js"><link rel="prefetch" href="/web-notes/assets/js/64.39d93267.js"><link rel="prefetch" href="/web-notes/assets/js/65.f3c9986d.js"><link rel="prefetch" href="/web-notes/assets/js/66.a359f367.js"><link rel="prefetch" href="/web-notes/assets/js/67.405291be.js"><link rel="prefetch" href="/web-notes/assets/js/68.d48eacc2.js"><link rel="prefetch" href="/web-notes/assets/js/69.a105325b.js"><link rel="prefetch" href="/web-notes/assets/js/7.a5b81e56.js"><link rel="prefetch" href="/web-notes/assets/js/70.374c3fa6.js"><link rel="prefetch" href="/web-notes/assets/js/71.fc419072.js"><link rel="prefetch" href="/web-notes/assets/js/72.7bec4037.js"><link rel="prefetch" href="/web-notes/assets/js/73.720c4a37.js"><link rel="prefetch" href="/web-notes/assets/js/74.f28f1601.js"><link rel="prefetch" href="/web-notes/assets/js/75.1baa837e.js"><link rel="prefetch" href="/web-notes/assets/js/76.3c5f81bd.js"><link rel="prefetch" href="/web-notes/assets/js/77.fc2392cc.js"><link rel="prefetch" href="/web-notes/assets/js/78.1c0c7841.js"><link rel="prefetch" href="/web-notes/assets/js/79.a34aeace.js"><link rel="prefetch" href="/web-notes/assets/js/8.b68fee1a.js"><link rel="prefetch" href="/web-notes/assets/js/80.34a0d28a.js"><link rel="prefetch" href="/web-notes/assets/js/81.d8fb4be3.js"><link rel="prefetch" href="/web-notes/assets/js/82.d1f8cf70.js"><link rel="prefetch" href="/web-notes/assets/js/83.6d11f312.js"><link rel="prefetch" href="/web-notes/assets/js/84.6878f06f.js"><link rel="prefetch" href="/web-notes/assets/js/85.dbc0a1ed.js"><link rel="prefetch" href="/web-notes/assets/js/86.fa58bd5e.js"><link rel="prefetch" href="/web-notes/assets/js/87.04a5e0be.js"><link rel="prefetch" href="/web-notes/assets/js/88.faa62c07.js"><link rel="prefetch" href="/web-notes/assets/js/89.c171f073.js"><link rel="prefetch" href="/web-notes/assets/js/9.3a9232b2.js"><link rel="prefetch" href="/web-notes/assets/js/90.c4819e9a.js"><link rel="prefetch" href="/web-notes/assets/js/91.ab06c6d0.js"><link rel="prefetch" href="/web-notes/assets/js/92.304e19ef.js"><link rel="prefetch" href="/web-notes/assets/js/93.23703751.js"><link rel="prefetch" href="/web-notes/assets/js/94.d377c944.js"><link rel="prefetch" href="/web-notes/assets/js/95.16a34550.js"><link rel="prefetch" href="/web-notes/assets/js/96.bc858025.js"><link rel="prefetch" href="/web-notes/assets/js/97.b67bf19e.js"><link rel="prefetch" href="/web-notes/assets/js/98.5a211417.js"><link rel="prefetch" href="/web-notes/assets/js/99.f2f34797.js">
    <link rel="stylesheet" href="/web-notes/assets/css/0.styles.8c3e9f07.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-notes/" class="home-link router-link-active"><!----> <span class="site-name">Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Languages/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frameworks" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Frameworks/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/web-notes/Book/" class="nav-link">
  Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Collect" class="dropdown-title"><span class="title">Collect</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Package/" class="nav-link">
  Package
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/E-Book/" class="nav-link">
  E-Book
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Article/" class="nav-link">
  Article
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Blog/" class="nav-link">
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Website/" class="nav-link">
  Website
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Tools/" class="nav-link">
  Tools
</a></li></ul></div></div> <a href="https://github.com/pointline/web-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Languages/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Languages/TypeScript/" class="nav-link">
  TypeScript
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Frameworks" class="dropdown-title"><span class="title">Frameworks</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Frameworks/React/" class="nav-link">
  React
</a></li></ul></div></div><div class="nav-item"><a href="/web-notes/Book/" class="nav-link">
  Book
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Collect" class="dropdown-title"><span class="title">Collect</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Package/" class="nav-link">
  Package
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/E-Book/" class="nav-link">
  E-Book
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Article/" class="nav-link">
  Article
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Blog/" class="nav-link">
  Blog
</a></li><li class="dropdown-item"><!----> <a href="/web-notes/Website/" class="nav-link">
  Website
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Others" class="dropdown-title"><span class="title">Others</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-notes/Tools/" class="nav-link">
  Tools
</a></li></ul></div></div> <a href="https://github.com/pointline/web-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DOM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Event</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>浏览器模型</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html" class="active sidebar-link">浏览器环境概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#script-元素" class="sidebar-link">script 元素</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#工作原理" class="sidebar-link">工作原理</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#defer-属性" class="sidebar-link">defer 属性</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#async-属性" class="sidebar-link">async 属性</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#脚本的动态加载" class="sidebar-link">脚本的动态加载</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#加载使用的协议" class="sidebar-link">加载使用的协议</a></li></ul></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#浏览器的组成" class="sidebar-link">浏览器的组成</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#渲染引擎" class="sidebar-link">渲染引擎</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#重流和重绘" class="sidebar-link">重流和重绘</a></li><li class="sidebar-sub-header"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.html#javascript-引擎" class="sidebar-link">JavaScript 引擎</a></li></ul></li></ul></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/02-window对象.html" class="sidebar-link">window 对象</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/03-Navigator 对象，Screen 对象.html" class="sidebar-link">Navigator 对象，Screen 对象</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/04-Cookie.html" class="sidebar-link">Cookie</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/05-XMLHttpRequest对象.html" class="sidebar-link">XMLHttpRequest 对象</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/06-同源限制.html" class="sidebar-link">同源限制</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/07-CORS通信.html" class="sidebar-link">CORS 通信</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/08-Storage接口.html" class="sidebar-link">Storage 接口</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/09-History对象.html" class="sidebar-link">History 对象</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/10-Location对象，URL对象，URLSearchParams对象.html" class="sidebar-link">Location 对象，URL 对象，URLSearchParams 对象</a></li><li><a href="/web-notes/Languages/JavaScript/05-浏览器模型/表单，FormData对象.html" class="sidebar-link">表单，FormData 对象</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Q&amp;A</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器环境概述"><a href="#浏览器环境概述" class="header-anchor">#</a> 浏览器环境概述</h1> <h2 id="script-元素"><a href="#script-元素" class="header-anchor">#</a> script 元素</h2> <h3 id="工作原理"><a href="#工作原理" class="header-anchor">#</a> 工作原理</h3> <p><code>浏览器加载 JavaScript 脚本，主要通过script元素完成。正常的网页加载流程是这样的</code></p> <ul><li><code>浏览器一边下载 HTML 网页，一边开始解析。也就是说，不等到下载完，就开始解析。</code></li> <li><code>解析过程中，浏览器发现script元素，就暂停解析，把网页渲染的控制权转交给 JavaScript 引擎。</code></li> <li><code>如果script元素引用了外部脚本，就下载该脚本再执行，否则就直接执行代码。</code></li> <li><code>JavaScript 引擎执行完毕，控制权交还渲染引擎，恢复往下解析 HTML 网页。</code></li></ul> <p><code>加载外部脚本时，浏览器会暂停页面渲染，等待脚本下载并执行完成后，再继续渲染。原因是 JavaScript 代码可以修改 DOM，所以必须把控制权让给它，否则会导致复杂的线程竞赛的问题。</code></p> <p><code>如果外部脚本加载时间很长（一直无法完成下载），那么浏览器就会一直等待脚本下载完成，造成网页长时间失去响应，浏览器就会呈现“假死”状态，这被称为“阻塞效应”。</code></p> <p><code>为了避免这种情况，较好的做法是将script标签都放在页面底部，而不是头部。这样即使遇到脚本失去响应，网页主体的渲染也已经完成了，用户至少可以看到内容，而不是面对一张空白的页面。如果某些脚本代码非常重要，一定要放在页面头部的话，最好直接将代码写入页面，而不是连接外部脚本文件，这样能缩短加载时间。</code></p> <p><code>脚本文件都放在网页尾部加载，还有一个好处。因为在 DOM 结构生成之前就调用 DOM 节点，JavaScript 会报错，如果脚本都在网页尾部加载，就不存在这个问题，因为这时 DOM 肯定已经生成了。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上面代码执行时会报错，因为此时document.body元素还未生成。</p> <p><code>一种解决方法是设定DOMContentLoaded事件的回调函数。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
      <span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>上面代码中，指定DOMContentLoaded事件发生后，才开始执行相关代码。DOMContentLoaded事件只有在 DOM 结构生成之后才会触发。</p> <p><code>另一种解决方法是，使用script标签的onload属性。当script标签指定的外部脚本文件下载和解析完成，会触发一个load事件，可以把所需执行的代码，放在这个事件的回调函数里面。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jquery.min.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>console.log(document.body.innerHTML)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>但是，如果将脚本放在页面底部，就可以完全按照正常的方式写，上面两种方式都不需要。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 其他代码  --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果有多个script标签，比如下面这样。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>浏览器会同时并行下载a.js和b.js，但是，执行时会保证先执行a.js，然后再执行b.js，即使后者先下载完成，也是如此。也就是说，脚本的执行顺序由它们在页面中的出现顺序决定，这是为了保证脚本之间的依赖关系不受到破坏。当然，加载这两个脚本都会产生“阻塞效应”，必须等到它们都加载完成，浏览器才会继续页面渲染。</code></p> <p><code>解析和执行 CSS，也会产生阻塞。Firefox 浏览器会等到脚本前面的所有样式表，都下载并解析完，再执行脚本；Webkit则是一旦发现脚本引用了样式，就会暂停执行脚本，等到样式表下载并解析完，再恢复执行。</code></p> <p><code>此外，对于来自同一个域名的资源，比如脚本文件、样式表文件、图片文件等，浏览器一般有限制，同时最多下载6～20个资源，即最多同时打开的 TCP 连接有限制，这是为了防止对服务器造成太大压力。如果是来自不同域名的资源，就没有这个限制。所以，通常把静态文件放在不同的域名之下，以加快下载速度。</code></p> <h3 id="defer-属性"><a href="#defer-属性" class="header-anchor">#</a> defer 属性</h3> <p><code>为了解决脚本文件下载阻塞网页渲染的问题，一个方法是对script元素加入defer属性。它的作用是延迟脚本的执行，等到 DOM 加载生成后，再执行脚本。</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;a.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;b.js&quot;</span> defer<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>上面代码中，只有等到 DOM 加载完成后，才会执行a.js和b.js。</p> <p><code>defer属性的运行流程如下。</code></p> <ul><li><code>浏览器开始解析 HTML 网页。</code></li> <li><code>解析过程中，发现带有defer属性的script元素。</code></li> <li><code>浏览器继续往下解析 HTML 网页，同时并行下载script元素加载的外部脚本。</code></li> <li><code>浏览器完成解析 HTML 网页，此时再回过头执行已经下载完成的脚本。</code></li></ul> <p><code>有了defer属性，浏览器下载脚本文件的时候，不会阻塞页面渲染。下载的脚本文件在DOMContentLoaded事件触发前执行（即刚刚读取完html标签），而且可以保证执行顺序就是它们在页面上出现的顺序。</code></p> <p><code>对于内置而不是加载外部脚本的script标签，以及动态生成的script标签，defer属性不起作用。另外，使用defer加载的外部脚本不应该使用document.write方法。</code></p> <h3 id="async-属性"><a href="#async-属性" class="header-anchor">#</a> async 属性</h3> <p><code>解决“阻塞效应”的另一个方法是对script元素加入async属性。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>a.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>b.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">async</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>async属性的作用是，使用另一个进程下载脚本，下载时不会阻塞渲染。</code></p> <ul><li><code>浏览器开始解析 HTML 网页。</code></li> <li><code>解析过程中，发现带有async属性的script标签。</code></li> <li><code>浏览器继续往下解析 HTML 网页，同时并行下载script标签中的外部脚本。</code></li> <li><code>脚本下载完成，浏览器暂停解析 HTML 网页，开始执行下载的脚本。</code></li> <li><code>脚本执行完毕，浏览器恢复解析 HTML 网页。</code></li></ul> <p><code>async属性可以保证脚本下载的同时，浏览器继续渲染。需要注意的是，一旦采用这个属性，就无法保证脚本的执行顺序。哪个脚本先下载结束，就先执行那个脚本。另外，使用async属性的脚本文件里面的代码，不应该使用document.write方法。</code></p> <p><code>defer属性和async属性到底应该使用哪一个？</code></p> <p><code>一般来说，如果脚本之间没有依赖关系，就使用async属性，如果脚本之间有依赖关系，就使用defer属性。如果同时使用async和defer属性，后者不起作用，浏览器行为由async属性决定。</code></p> <h3 id="脚本的动态加载"><a href="#脚本的动态加载" class="header-anchor">#</a> 脚本的动态加载</h3> <p>script元素还可以动态生成，生成后再插入页面，从而实现脚本的动态加载。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">,</span> <span class="token string">'b.js'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>这种方法的好处是，动态生成的script标签不会阻塞页面渲染，也就不会造成浏览器假死。但是问题在于，这种方法无法保证脚本的执行顺序，哪个脚本文件先下载完成，就先执行哪个。</code></p> <p><code>如果想避免这个问题，可以设置async属性为false。</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token string">'a.js'</span><span class="token punctuation">,</span> <span class="token string">'b.js'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>上面的代码不会阻塞页面渲染，而且可以保证b.js在a.js后面执行。不过需要注意的是，在这段代码后面加载的脚本文件，会因此都等待b.js执行完成后再执行。</code></p> <p><code>如果想为动态加载的脚本指定回调函数，可以使用下面的写法。</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">loadScript</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> js <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  js<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  js<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  js<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Failed to load script '</span> <span class="token operator">+</span> src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>js<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="加载使用的协议"><a href="#加载使用的协议" class="header-anchor">#</a> 加载使用的协议</h3> <p><code>如果不指定协议，浏览器默认采用 HTTP 协议下载。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>上面的example.js默认就是采用 HTTP 协议下载，如果要采用 HTTPS 协议下载，必需写明。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>但是有时我们会希望，根据页面本身的协议来决定加载协议，这时可以采用下面的写法。</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>//example.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="浏览器的组成"><a href="#浏览器的组成" class="header-anchor">#</a> 浏览器的组成</h2> <p><code>浏览器的核心是两部分：渲染引擎和 JavaScript 解释器（又称 JavaScript 引擎）。</code></p> <h3 id="渲染引擎"><a href="#渲染引擎" class="header-anchor">#</a> 渲染引擎</h3> <p><code>渲染引擎的主要作用是，将网页代码渲染为用户视觉可以感知的平面文档。</code></p> <p><code>不同的浏览器有不同的渲染引擎。</code></p> <ul><li>Firefox：Gecko 引擎</li> <li>Safari：WebKit 引擎</li> <li>Chrome：Blink 引擎</li> <li>IE: Trident 引擎</li> <li>Edge: EdgeHTML 引擎</li></ul> <p><code>渲染引擎处理网页，通常分成四个阶段。</code></p> <ul><li><code>解析代码：HTML 代码解析为 DOM，CSS 代码解析为 CSSOM（CSS Object Model）。</code></li> <li><code>对象合成：将 DOM 和 CSSOM 合成一棵渲染树（render tree）。</code></li> <li><code>布局：计算出渲染树的布局（layout）。</code></li> <li><code>绘制：将渲染树绘制到屏幕。</code></li></ul> <p><code>以上四步并非严格按顺序执行，往往第一步还没完成，第二步和第三步就已经开始了。所以，会看到这种情况：网页的 HTML 代码还没下载完，但浏览器已经显示出内容了。</code></p> <h3 id="重流和重绘"><a href="#重流和重绘" class="header-anchor">#</a> 重流和重绘</h3> <p><code>渲染树转换为网页布局，称为“布局流”（flow）；布局显示到页面的这个过程，称为“绘制”（paint）。它们都具有阻塞效应，并且会耗费很多时间和计算资源。</code></p> <p><code>页面生成以后，脚本操作和样式表操作，都会触发“重流”（reflow）和“重绘”（repaint）。用户的互动也会触发重流和重绘，比如设置了鼠标悬停（a:hover）效果、页面滚动、在输入框中输入文本、改变窗口大小等等。</code></p> <p><code>重流和重绘并不一定一起发生，重流必然导致重绘，重绘不一定需要重流。比如改变元素颜色，只会导致重绘，而不会导致重流；改变元素的布局，则会导致重绘和重流。</code></p> <p><code>大多数情况下，浏览器会智能判断，将重流和重绘只限制到相关的子树上面，最小化所耗费的代价，而不会全局重新生成网页。</code></p> <p><code>作为开发者，应该尽量设法降低重绘的次数和成本。比如，尽量不要变动高层的 DOM 元素，而以底层 DOM 元素的变动代替；再比如，重绘table布局和flex布局，开销都会比较大。</code></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'foobar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

foo<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>style<span class="token punctuation">.</span>marginTop <span class="token operator">=</span> <span class="token string">'30px'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>上面的代码只会导致一次重绘，因为浏览器会累积 DOM 变动，然后一次性执行。</code></p> <p>下面是一些优化技巧。</p> <ul><li><code>读取 DOM 或者写入 DOM，尽量写在一起，不要混杂。不要读取一个 DOM 节点，然后立刻写入，接着再读取一个 DOM 节点。</code></li> <li><code>缓存 DOM 信息。</code></li> <li><code>不要一项一项地改变样式，而是使用 CSS class 一次性改变样式。</code></li> <li><code>使用documentFragment操作 DOM</code></li> <li><code>动画使用absolute定位或fixed定位，这样可以减少对其他元素的影响。</code></li> <li><code>只在必要时才显示隐藏元素。</code></li> <li><code>使用window.requestAnimationFrame()，因为它可以把代码推迟到下一次重流时执行，而不是立即要求页面重流。</code></li> <li><code>使用虚拟 DOM（virtual DOM）库。</code></li></ul> <p>下面是一个window.requestAnimationFrame()对比效果的例子。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 重绘代价高</span>
<span class="token keyword">function</span> <span class="token function">doubleHeight</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>
  element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>currentHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

all_my_elements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>doubleHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 重绘代价低</span>
<span class="token keyword">function</span> <span class="token function">doubleHeight</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentHeight <span class="token operator">=</span> element<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>

  window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token punctuation">(</span>currentHeight <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

all_my_elements<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>doubleHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p><code>上面的第一段代码，每读一次 DOM，就写入新的值，会造成不停的重排和重流。第二段代码把所有的写操作，都累积在一起，从而 DOM 代码变动的代价就最小化了。</code></p> <h3 id="javascript-引擎"><a href="#javascript-引擎" class="header-anchor">#</a> JavaScript 引擎</h3> <p>JavaScript 引擎的主要作用是，读取网页中的 JavaScript 代码，对其处理后运行。</p> <p><code>JavaScript 是一种解释型语言，也就是说，它不需要编译，由解释器实时运行。这样的好处是运行和修改都比较方便，刷新页面就可以重新解释；缺点是每次运行都要调用解释器，系统开销较大，运行速度慢于编译型语言。</code></p> <p><code>为了提高运行速度，目前的浏览器都将 JavaScript 进行一定程度的编译，生成类似字节码（bytecode）的中间代码，以提高运行速度。</code></p> <p><code>早期，浏览器内部对 JavaScript 的处理过程如下：</code></p> <ul><li><code>读取代码，进行词法分析（Lexical analysis），将代码分解成词元（token）。</code></li> <li><code>对词元进行语法分析（parsing），将代码整理成“语法树”（syntax tree）。</code></li> <li><code>使用“翻译器”（translator），将代码转为字节码（bytecode）。</code></li> <li><code>使用“字节码解释器”（bytecode interpreter），将字节码转为机器码。</code></li></ul> <p><code>逐行解释将字节码转为机器码，是很低效的。为了提高运行速度，现代浏览器改为采用“即时编译”（Just In Time compiler，缩写 JIT），即字节码只在运行时编译，用到哪一行就编译哪一行，并且把编译结果缓存（inline cache）。通常，一个程序被经常用到的，只是其中一小部分代码，有了缓存的编译结果，整个程序的运行速度就会显著提升。</code></p> <p><code>字节码不能直接运行，而是运行在一个虚拟机（Virtual Machine）之上，一般也把虚拟机称为 JavaScript 引擎。并非所有的 JavaScript 虚拟机运行时都有字节码，有的 JavaScript 虚拟机基于源码，即只要有可能，就通过 JIT（just in time）编译器直接把源码编译成机器码运行，省略字节码步骤。这一点与其他采用虚拟机（比如 Java）的语言不尽相同。这样做的目的，是为了尽可能地优化代码、提高性能。下面是目前最常见的一些 JavaScript 虚拟机：</code></p> <ul><li>Chakra (Microsoft Internet Explorer)</li> <li>Nitro/JavaScript Core (Safari)</li> <li>Carakan (Opera)</li> <li>SpiderMonkey (Firefox)</li> <li>V8 (Chrome, Chromium)</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/pointline/web-notes/edit/master/docs/Languages/JavaScript/05-浏览器模型/01-浏览器环境概述.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/14/2020, 3:16:26 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-notes/Languages/JavaScript/04-Event/11-GlobalEventHandlers接口.html" class="prev">
        GlobalEventHandlers 接口
      </a></span> <span class="next"><a href="/web-notes/Languages/JavaScript/05-浏览器模型/02-window对象.html">
        window 对象
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/web-notes/assets/js/app.4d3d7f31.js" defer></script><script src="/web-notes/assets/js/2.ff08d743.js" defer></script><script src="/web-notes/assets/js/100.498b8ac0.js" defer></script>
  </body>
</html>
